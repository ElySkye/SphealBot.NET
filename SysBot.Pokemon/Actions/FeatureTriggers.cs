using PKHeX.Core;
using PKHeX.Core.AutoMod;
using System;

namespace SysBot.Pokemon
{
    //Held items to trigger Special Feature Swaps [SV/SWSH]
    public enum SwapItem
    {
        None = 0,
        AbilityCapsule = 645,
        AbilityPatch = 1606,
        AbilityShield = 1881,
        AbsorbBulb = 545,
        AdamantMint = 1232,
        AdrenalineOrb = 846,
        AguavBerry = 162,
        AirBalloon = 541,
        AmuletCoin = 223,
        Antidote = 18,
        ApicotBerry = 205,
        AspearBerry = 153,
        AssaultVest = 640,
        AuspiciousArmor = 2344,
        Awakening = 21,
        BabiriBerry = 199,
        BalmMushroom = 580,
        BigBambooShoot = 1843,
        BigMushroom = 87,
        BigNugget = 581,
        BigPearl = 89,
        BigRoot = 296,
        BindingBand = 544,
        BlackBelt = 241,
        BlackGlasses = 240,
        BlackSludge = 281,
        BlunderPolicy = 1121,
        BoldMint = 1235,
        BoosterEnergy = 1880,
        BottleCap = 795,
        BraveMint = 1234,
        BrightPowder = 213,
        BurnHeal = 19,
        Calcium = 49,
        CalmMint = 1243,
        Carbos = 48,
        CarefulMint = 1245,
        CellBattery = 546,
        Charcoal = 249,
        ChartiBerry = 195,
        CheriBerry = 149,
        ChestoBerry = 150,
        ChilanBerry = 200,
        ChippedPot = 1254,
        ChoiceBand = 220,
        ChoiceScarf = 287,
        ChoiceSpecs = 297,
        ChopleBerry = 189,
        CleanseTag = 224,
        ClearAmulet = 1882,
        CleverFeather = 569,
        CobaBerry = 192,
        ColburBerry = 198,
        CometShard = 583,
        CovertCloak = 1885,
        CrackedPot = 1253,
        DampRock = 285,
        DawnStone = 109,
        DestinyKnot = 280,
        DireHit = 56,
        DragonFang = 250,
        DuskStone = 108,
        EjectButton = 547,
        EjectPack = 1119,
        ElectricSeed = 881,
        Elixir = 40,
        EnergyPowder = 34,
        EnergyRoot = 35,
        Ether = 38,
        Everstone = 229,
        Eviolite = 538,
        ExpCandyL = 1127,
        ExpCandyM = 1126,
        ExpCandyS = 1125,
        ExpCandyXL = 1128,
        ExpCandyXS = 1124,
        ExpertBelt = 268,
        FigyBerry = 159,
        FireStone = 82,
        FlameOrb = 273,
        FloatStone = 539,
        FocusBand = 230,
        FocusSash = 275,
        FreshWater = 30,
        FullHeal = 27,
        FullRestore = 23,
        GanlonBerry = 202,
        GeniusFeather = 568,
        GentleMint = 1244,
        GoldBottleCap = 796,
        GrassySeed = 884,
        GrepaBerry = 173,
        GripClaw = 286,
        GuardSpec = 55,
        HabanBerry = 197,
        HardStone = 238,
        HastyMint = 1248,
        HealPowder = 36,
        HealthFeather = 565,
        HeatRock = 284,
        HeavyDutyBoots = 1120,
        HondewBerry = 172,
        Honey = 94,
        HPUp = 45,
        HyperPotion = 25,
        IapapaBerry = 163,
        IceHeal = 20,
        IceStone = 849,
        IcyRock = 282,
        ImpishMint = 1236,
        Iron = 47,
        IronBall = 278,
        JollyMint = 1249,
        KasibBerry = 196,
        KebiaBerry = 190,
        KeeBerry = 687,
        KelpsyBerry = 170,
        KingsRock = 221,
        LaggingTail = 279,
        LansatBerry = 206,
        LaxMint = 1237,
        LeadersCrest = 2345,
        LeafStone = 85,
        Leftovers = 234,
        Lemonade = 32,
        LeppaBerry = 154,
        LiechiBerry = 201,
        LifeOrb = 270,
        LightBall = 236,
        LightClay = 269,
        LoadedDice = 1886,
        LonelyMint = 1231,
        LuckyEgg = 231,
        LumBerry = 157,
        LuminousMoss = 648,
        Magnet = 242,
        MagoBerry = 161,
        MaliciousArmor = 1861,
        MarangaBerry = 688,
        MaxElixir = 41,
        MaxEther = 39,
        MaxPotion = 24,
        MaxRevive = 29,
        MentalHerb = 219,
        MetalCoat = 233,
        Metronome = 277,
        MildMint = 1240,
        MiracleSeed = 239,
        MirrorHerb = 1883,
        MistySeed = 883,
        ModestMint = 1239,
        MoomooMilk = 33,
        MoonStone = 81,
        MuscleBand = 266,
        MuscleFeather = 566,
        MysticWater = 243,
        NaiveMint = 1250,
        NaughtyMint = 1233,
        NeverMeltIce = 246,
        NormalGem = 564,
        Nugget = 92,
        OccaBerry = 184,
        OranBerry = 155,
        OvalStone = 110,
        ParalyzeHeal = 22,
        PasshoBerry = 185,
        PayapaBerry = 193,
        Pearl = 88,
        PearlString = 582,
        PechaBerry = 151,
        PersimBerry = 156,
        PetayaBerry = 204,
        PinkNectar = 855,
        PoisonBarb = 245,
        PokéDoll = 63,
        PomegBerry = 169,
        Potion = 17,
        PowerAnklet = 293,
        PowerBand = 292,
        PowerBelt = 290,
        PowerBracer = 289,
        PowerHerb = 271,
        PowerLens = 291,
        PowerWeight = 294,
        PPMax = 53,
        PPUp = 51,
        PrettyFeather = 571,
        ProtectivePads = 880,
        Protein = 46,
        PsychicSeed = 882,
        PunchingGlove = 1884,
        PurpleNectar = 856,
        QualotBerry = 171,
        QuickClaw = 217,
        QuietMint = 1242,
        RareBone = 106,
        RareCandy = 50,
        RashMint = 1241,
        RawstBerry = 152,
        RazorClaw = 326,
        RedCard = 542,
        RedNectar = 853,
        RelaxedMint = 1238,
        ResistFeather = 567,
        RevivalHerb = 37,
        Revive = 28,
        RindoBerry = 187,
        RingTarget = 543,
        RockyHelmet = 540,
        RoomService = 1122,
        RoseliBerry = 686,
        SafetyGoggles = 650,
        SalacBerry = 203,
        SassyMint = 1246,
        ScopeLens = 232,
        SeriousMint = 1251,
        SharpBeak = 244,
        ShedShell = 295,
        ShellBell = 253,
        ShinyStone = 107,
        ShucaBerry = 191,
        SilkScarf = 251,
        SilverPowder = 222,
        SitrusBerry = 158,
        SmoothRock = 283,
        Snowball = 649,
        SodaPop = 31,
        SoftSand = 237,
        SootheBell = 218,
        SpellTag = 247,
        Stardust = 90,
        StarfBerry = 207,
        StarPiece = 91,
        StickyBarb = 288,
        SunStone = 80,
        SuperPotion = 26,
        SweetApple = 1116,
        SwiftFeather = 570,
        TamatoBerry = 174,
        TangaBerry = 194,
        TartApple = 1117,
        TerrainExtender = 879,
        ThroatSpray = 1118,
        ThunderStone = 83,
        TimidMint = 1247,
        TinyBambooShoot = 1842,
        TinyMushroom = 86,
        ToxicOrb = 272,
        TwistedSpoon = 248,
        UtilityUmbrella = 1123,
        WacanBerry = 186,
        WaterStone = 84,
        WeaknessPolicy = 639,
        WhiteHerb = 214,
        WideLens = 265,
        WikiBerry = 160,
        WiseGlasses = 267,
        XAccuracy = 60,
        XAttack = 57,
        XDefense = 58,
        XSpAtk = 61,
        XSpDef = 62,
        XSpeed = 59,
        YacheBerry = 188,
        YellowNectar = 854,
        Zinc = 52,
        ZoomLens = 276,
        //Home
        RustedSword = 1104,
        RustedShield = 1105,
        AdamantOrb = 135,
        LustrousOrb = 136,
        AdamantCrystal = 1777,
        LustrousGlobe = 1778,
        GriseousOrb = 112,
        GriseousCore = 1779,
        FlamePlate = 298,
        SplashPlate = 299,
        ZapPlate = 300,
        MeadowPlate = 301,
        IciclePlate = 302,
        FistPlate = 303,
        ToxicPlate = 304,
        EarthPlate = 305,
        SkyPlate = 306,
        MindPlate = 307,
        InsectPlate = 308,
        StonePlate = 309,
        SpookyPlate = 310,
        DracoPlate = 311,
        DreadPlate = 312,
        IronPlate = 313,
        PixiePlate = 644,
        //DLC 1
        SyrupyApple = 2402,
        UnremarkableTeacup = 2403,
        MasterpieceTeacup = 2404,
        CornerstoneMask = 2406,
        WellspringMask = 2407,
        HearthflameMask = 2408,
        //DLC 2 - todo
        MAX_COUNT,
    }
    public enum EmbedColor : uint
    {
        None = 0x0,

        Master = 0x5a5396,
        Ultra = 0x414141,
        Great = 0x2095f1,
        Poke = 0xff3434,

        Safari = 0x577a57,

        Net = 0x1d8281,
        Dive = 0x2b96db,
        Nest = 0x577e5c,
        Repeat = 0xd05c37,
        Timer = 0xffffff,
        Luxury = 0x313131,
        Premier = 0xffffff,
        Dusk = 0x68bb4e,
        Heal = 0xffb8f8,
        Quick = 0x4472bf,

        Cherish = 0xff553d,

        Fast = 0xff423c,
        Level = 0xe1f8fa,
        Lure = 0x1a83a2,
        Heavy = 0x59504c,
        Love = 0xff7690,
        Friend = 0x199657,
        Moon = 0x2f2827,

        Sport = 0xff6829,
        Dream = 0xffc9ff,
        Beast = 0x002a52,

        // Legends: Arceus
        Strange = 27,
        LAPoke = 0xd25a00,
        LAGreat = 0x354989,
        LAUltra = 0x413c3c,
        LAFeather = 0x2990b6,
        LAWing = 0xe1f8fa,
        LAJet = 0x2890b6,
        LAHeavy = 0x354989,
        LALeaden = 0x302d30,
        LAGigaton = 0x302c30,
        LAOrigin = 0xfe785a
    }
    public class FeatureTrigger<T> where T : PKM, new()
    {
        public static void AllowEggShowdown(PKM cln)
        {
            cln.IsEgg = true;
            cln.IsNicknamed = true;
            cln.Nickname = cln.Language switch
            {
                1 => "タマゴ",
                3 => "Œuf",
                4 => "Uovo",
                5 => "Ei",
                7 => "Huevo",
                8 => "알",
                9 or 10 => "蛋",
                _ => "Egg",
            };

            cln.Egg_Location = cln switch
            {
                PK9 => 30023, //SV
                PK8 => 60002, //SWSH
                _ => 60010, //BDSP
            };
            cln.Met_Location = cln switch
            {
                PK9 => 0, //SV
                PK8 => 30002, //SWSH
                _ => 65535, //BDSP
            };

            cln.MetDate = DateOnly.FromDateTime(DateTime.Now); //Match MetDate & EggMetDate
            cln.EggMetDate = cln.MetDate;

            cln.HeldItem = 0;
            cln.CurrentLevel = 1;
            cln.EXP = 0;
            cln.Met_Level = 1;
            cln.StatNature = cln.Nature;
            cln.OT_Friendship = 1;

            if (cln is PK9 SV)
            {
                SV.TeraTypeOverride = (MoveType)19;
                SV.Obedience_Level = 1;
                SV.Version = 0; //Eggs should have no version in SV
            }

            //Merged from Koi [https://github.com/Koi-3088/ForkBot.NET]
            var la = new LegalityAnalysis(cln);
            var enc = la.EncounterMatch;
            Span<ushort> relearn = stackalloc ushort[4];

            cln.ClearRelearnMoves();
            cln.SetSuggestedMoves();
            la.GetSuggestedRelearnMoves(relearn, enc);
            cln.SetRelearnMoves(relearn);
            cln.Move1_PPUps = cln.Move2_PPUps = cln.Move3_PPUps = cln.Move4_PPUps = 0;
            cln.SetSuggestedHyperTrainingData();
            cln.CurrentFriendship = enc is IHatchCycle s ? s.EggCycles : cln.PersonalInfo.HatchCycles;
            cln.HealPP();
            cln.RefreshChecksum();
        }
    }
}